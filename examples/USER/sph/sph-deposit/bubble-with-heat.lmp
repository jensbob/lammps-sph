log                ${dname}/log.lammps
echo               both
dimension          3
units              si
atom_style         meso
boundary          p p p
include           3d-wall.lmp
# create simulation box
variable           Lywall equal ${Ly}+6*${dx}
region             box block 0.0 ${Lx}  0.0 ${Lywall} 0.0 ${Lz} units box
create_box         2 box

# create fluid particles
lattice            sc ${dx}
create_atoms       1 region box

variable           ylow equal 3*${dx}
variable           yhi  equal ${Ly}+3*${dx}
region	     rl block INF INF 0 ${ylow} INF INF units box
group	     lower region rl
region	     ru block INF INF ${yhi} INF INF INF units box
group	     upper region ru
group	     boundary union lower upper
group	     flow subtract all boundary

variable           dre     equal 0.5*${h}
variable           xcenter equal 0.5*${Lx}
variable           xcmin   equal ${xcenter}-${dre}
variable           xcmax   equal ${xcenter}+${dre}

variable           zcenter equal 0.5*${Lz}
variable           zcmin   equal ${zcenter}-${dre}
variable           zcmax   equal ${zcenter}+${dre}

variable           ycmin   equal ${ylow}
variable           ycmax   equal ${ylow}+${dre}

region       depre block ${xcmin} ${xcmax} ${ycmin} ${ycmax} ${zcmin} ${zcmax} units box
#delete_atoms region depre

# all solvent atoms
group              gsolvent_tmp type 1
group              gsolvent subtract gsolvent_tmp boundary

mass               1 ${sph_mass_w}
mass               2 ${sph_mass_a}
set                group all meso_rho ${sph_rho_w}

#set                group all  meso_e 1.0
#set                group all  meso_cv 1.0

# use Tait's EOS in combination with Morris' laminar viscosity.
# We set rho_0 = 1000 kg/m^3, c = 0.1 m/s, h = 6.5e-5 m.
# The dynamic viscosity is set to 1.0e-3 Pa s, corresponding to a kinematic viscosity of 1.0e-6 m^2/s
pair_style         hybrid/overlay sph/rhosum 1 sph/colorgradient 1 sph/taitwater/morris sph/surfacetension
pair_coeff         * * sph/rhosum   ${h}
pair_coeff         1 1 sph/colorgradient ${h} 0
pair_coeff         1 2 sph/colorgradient ${h} 5e-12
pair_coeff         2 2 sph/colorgradient ${h} 0

pair_coeff         1 1 sph/taitwater/morris ${sph_rho_w} ${sph_c} ${sph_eta} ${h}
pair_coeff         1 2 sph/taitwater/morris ${sph_rho_w} ${sph_c} ${sph_eta} ${h}
pair_coeff         2 2 sph/taitwater/morris ${sph_rho_a} ${sph_c} ${sph_eta} ${h}

pair_coeff         * * sph/surfacetension ${alpha} ${h}
#pair_coeff         * * sph/heatconduction 1e-3 ${h}

compute            rho_peratom all meso_rho/atom
compute            colorgradient_peratom all meso_colorgradient/atom
#compute            e_peratom all meso_e/atom

# do full time integration for shear driver and fluid, but keep walls stationary
fix                integrate_fix_full flow meso

# force on the buble atoms
variable            var_gx_bubble atom ${gx}*${sph_mass_a}
fix                 fb_gx flow addforce v_var_gx_bubble 0 0

dump               dump_id all custom ${Nfreq} ${dname}/dump*.dat id type x y z vx vy vy fx fy fz &
c_rho_peratom c_colorgradient_peratom

dump_modify        dump_id first yes
dump_modify        dump_id sort id
dump_modify        dump_id pad 8
thermo_modify      norm no
thermo             1000

include            ${ndim}-image.lmp
variable           sph_mu  equal ${sph_eta}/${sph_rho_w}
include            settimestep.lmp

neighbor           3.0e-6 bin
neigh_modify       delay 0 every 1

timestep           ${dt}
communicate        single vel yes

fix          wallim boundary setforce 0 0 0

variable     bubble_type equal 2
fix          depfix flow deposit 500 ${bubble_type} 150 12345 region depre vy 0 0.1

run          500000

echo               both
dimension          ${ndim}
units              si
atom_style       hybrid bond meso
boundary          p p p

# create simulation box
#2D box
include            2d-vars.lmp
region             box block 0.0 ${Lx}  0.0 ${Ly} ${nLz} ${pLz} units box
read_data          poly2d.txt
#read_data           sdpd.restart.1000000

# create fluid particles
lattice         sq ${dx}

special_bonds   lj 1 1 1
bond_style fene
bond_coeff 1 ${H} ${r0}  0 0

group              polymer type 2
group              solvent type 1
mass               * ${sdpd_mass}
set                group all meso_rho ${sdpd_rho}


# use Tait's EOS in combination with Morris' laminar viscosity.
# We set rho_0 = 1000 kg/m^3, c = 0.1 m/s, h = 6.5e-5 m.
# The dynamic viscosity is set to 1.0e-3 Pa s, corresponding to a kinematic viscosity of 1.0e-6 m^2/s
#The temperature is set to 1e14.

pair_style         hybrid/overlay sph/rhosum 1 sdpd
pair_coeff         * * sph/rhosum   ${h}
pair_coeff         * *    sdpd ${sdpd_rho} ${sdpd_c} ${sdpd_eta} ${h} ${sdpd_temp}

compute            rho_peratom all meso_rho/atom
compute            sdpd_kin all temp
#variable           etot equal c_ke+c_esph


# do full time integration for shear driver and fluid, but keep walls stationary
fix                integrate_fix_full all meso
variable kfx_pre atom mass*${Apre}*(${x0}-x)
variable kfy_pre atom mass*${Apre}*(${y0}-y)
variable kfz_pre equal 0
fix pre_springf polymer addforce v_kfx_pre v_kfy_pre v_kfz_pre

# "profile" corrected temperature
compute         pTemp all temp/profile 1 1 0 y 5

# average velocity
#compute vxav all reduce ave vx
#variable  vx_cm atom vx-c_vxav
#fix av_vx all ave/spatial 1 ${Nfreq} ${Nfreq} &
#y center 0.01 v_vx_cm file vx.av ave running units reduced



thermo             1000
thermo_style       custom step  c_sdpd_kin c_pTemp
thermo_modify      norm no
dump               dump_u all custom 1000 dumpu*.dat id type xu yu vx vy c_rho_peratom
dump_modify        dump_u first yes
dump_modify        dump_u sort id
dump_modify        dump_u pad 8

include            ${ndim}-image.lmp
#dump imgDump all image 1000 image.*.jpg type type atom yes bond type 5e-6 adiam 8e-6 view 0 0 zoom 1.75
#dump_modify        imgDump pad 9
#dump_modify         imgDump acolor '*' red/green

variable           eps equal 0.25*${dx}
neighbor           ${eps} bin

neigh_modify       delay 0 every 1
include            settimestep.lmp
timestep           ${dt}
communicate        single vel yes

restart 100000 sdpd.restart

# move polymer to the center
run 50000
unfix pre_springf

variable kfx atom mass*${kst}*(${x0}-x)
variable kfy atom mass*${kst}*(${y0}-y)
variable kfz equal 0
# spring force
fix springf polymer addforce v_kfx v_kfy v_kfz


#dump               dump_id all custom 1000 dump*.dat id type x y vx vy c_rho_peratom
#dump_modify        dump_id first yes
#dump_modify        dump_id sort id
#dump_modify        dump_id pad 8

run ${ntime}

echo               both
dimension          3
units              si
atom_style        meso
boundary          p p p

# create simulation box
#3D box
variable           Lx  equal 1.00
variable           Ly  equal 1.00
variable           Lz  equal 1.00
region             box block 0.0 ${Lx}  0.0 ${Ly} 0.0 ${Lz} units box
variable           h equal 0.1
variable           sdpd_cutoff equal 3.0*${h}
lattice            sc ${h}
create_box         1 box
create_atoms       1 box

variable          npart equal count(all)
print             "number of atoms:  ${npart}"

variable           temp equal 1e19
variable           rho  equal 1.0
variable           vsoudn equal 0.0
variable           eta equal 0.01

mass               1 ${Lx}*${Ly}*${Lz}*${rho}/${npart}
set                group all meso_rho ${rho}

# smothing length


pair_style         sdpd
pair_coeff         * *  ${rho} ${vsoudn} ${eta} ${sdpd_cutoff} ${temp}

compute            rho_peratom all meso_rho/atom
compute            e_peratom all meso_e/atom
compute            ke_peratom all ke/atom
compute            esph all reduce sum c_e_peratom
compute            ke all ke
compute            sdpd_kin all temp
variable           etot equal c_ke+c_esph

#compute            sdpd_kin all temp
#compute            rho_peratom all meso_rho/atom

# do full time integration for shear driver and fluid, but keep walls stationary
fix                integrate_fix_full all meso

dump               dump_id all custom 100 dump*.dat id type x y z vx vy vz c_rho_peratom

dump_modify        dump_id first yes
dump_modify        dump_id sort id
dump_modify        dump_id pad 8
thermo_style       custom step c_sdpd_kin
thermo_modify      norm no
thermo             1

#neighbor           3.0e-6 bin
# add external force
#variable gy equal 1.0
#variable fy atom mass*${gy}*((x>${Lx}/2.0)-(x<${Lx}/2.0))
#fix reverce_periodic all addforce 0.0 v_fy 0.0 

include            timestep.lmp
timestep           ${dt}
run                40000

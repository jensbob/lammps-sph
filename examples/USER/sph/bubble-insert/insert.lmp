log                ${dname}/log.lammps
echo               both
dimension          2
units              si
atom_style         meso
# periodic boundaries to have a correct density on the wall
# TODO: make density fixed for the choosen particles
boundary          p p p
variable          ndim index 2d
include            ${ndim}-vars.lmp

# create simulation box
variable           pLz    equal  1.0e-3
variable           nLz    equal  -1.0e-3
variable           Lywall equal ${Ly}+6*${dx}
variable           Lxwall equal ${Lx}+6*${dx}
variable           xcenter equal 0.5*${Lxwall}
variable           ycenter equal 0.5*${Lywall}
region             box block 0.0 ${Lxwall}  0.0 ${Lywall} ${nLz} ${pLz} units box

# create box with two types of particles (water, gas, wall)
create_box         3 box

# create gas particles
lattice            sq ${dx}
create_atoms       ${g_type} region box

variable     ylow equal 3*${dx}
variable     yhi  equal ${Ly}+2.5*${dx}

variable     xlow equal 3*${dx}
variable     xhi  equal ${Lx}+2.5*${dx}

region	     rflow block ${xlow} ${xhi} ${ylow} ${yhi} INF INF units box
group	     flow region rflow
group	     boundary subtract all flow

# fix wall particles
fix          wallim boundary setforce 0 0 0
set          group boundary type ${w_type}

# set mass of the particles
mass               ${d_type} ${sph_mass_d}
mass               ${g_type} ${sph_mass_g}
mass               ${w_type} ${sph_mass_w}

set                 type ${d_type} meso_rho ${sph_rho_d}
set                 type ${g_type} meso_rho ${sph_rho_g}
set                 type ${w_type} meso_rho ${sph_rho_w}

compute            rho_peratom all meso_rho/atom
compute            colorgradient_peratom all meso_colorgradient/atom

# do full time integration for all particles
fix                integrate_fix_full all meso

dump               dump_id all custom ${Nfreq} ${dname}/dump*.dat id type x y z vx vy vy fx fy fz c_rho_peratom c_colorgradient_peratom
dump_modify        dump_id first yes sort id pad 8

include            ${ndim}-image.lmp
variable           sph_mu  equal ${sph_eta_d}/${sph_rho_d}
include            settimestep.lmp

neighbor           3.0e-2 bin
neigh_modify       delay 0 every 1

communicate        single vel yes
set                group all meso_rho ${sph_rho_g}

pair_style         hybrid/overlay sph/rhosum_multiphase 1 sph/colorgradient 1 sph/taitwater/morris sph/surfacetension
pair_coeff         * * sph/rhosum_multiphase   ${h}
pair_coeff         ${d_type} ${d_type} sph/colorgradient ${h} 0
pair_coeff         ${g_type} ${d_type} sph/colorgradient ${h} ${alpha}
pair_coeff         ${g_type} ${g_type} sph/colorgradient ${h} 0
pair_coeff         ${g_type} ${w_type} sph/colorgradient ${h} 0
pair_coeff         ${d_type} ${w_type} sph/colorgradient ${h} ${alpha}
pair_coeff         ${w_type} ${w_type} sph/colorgradient ${h} 0

# harmonic mean of viscosities
variable           sph_eta_gd equal 2*${sph_eta_g}*${sph_eta_d}/(${sph_eta_d}+${sph_eta_g})
variable           sph_eta_gw equal 2*${sph_eta_g}*${sph_eta_w}/(${sph_eta_g}+${sph_eta_w})
variable           sph_eta_dw equal 2*${sph_eta_d}*${sph_eta_w}/(${sph_eta_d}+${sph_eta_w})
pair_coeff         ${g_type} ${d_type} sph/taitwater/morris ${sph_rho_g} ${sph_c_g} ${sph_eta_gd} ${h}
pair_coeff         ${g_type} ${g_type} sph/taitwater/morris ${sph_rho_g} ${sph_c_g} ${sph_eta_g} ${h}
pair_coeff         ${g_type} ${w_type} sph/taitwater/morris ${sph_rho_g} ${sph_c_g} ${sph_eta_gw} ${h}
pair_coeff         ${d_type} ${d_type} sph/taitwater/morris ${sph_rho_d} ${sph_c_d} ${sph_eta_d} ${h}
pair_coeff         ${d_type} ${w_type} sph/taitwater/morris ${sph_rho_g} ${sph_c_g} ${sph_eta_dw} ${h}
pair_coeff         ${w_type} ${w_type} sph/taitwater/morris ${sph_rho_g} ${sph_c_g} ${sph_eta_w} ${h}

pair_coeff         * * sph/surfacetension ${h}

dump               dump_xyz all xyz ${Nfreq} ${dname}/data.xyz
dump_modify        dump_xyz element A B H

variable            time equal step*dt
thermo_style        custom step v_time
thermo              10

# create droplet
variable           x1 equal ${xcenter}-${dx}
variable           x2 equal ${xcenter}+${dx}

variable           y1 equal ${ylow}
variable           y2 equal ${ylow}+${dx}

region             rinsert block ${x1} ${x2} ${y1} ${y2} EDGE EDGE units box
variable           Ninsert equal 1000
variable           insert_every equal 10
fix                fdep all deposit ${Ninsert} ${d_type} ${insert_every} 123456 region rinsert units box

timestep           ${dt}
run               10000

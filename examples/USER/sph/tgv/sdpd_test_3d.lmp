echo               both
dimension          3
units              si
atom_style         meso

# create simulation box
#3D box
variable           dx   equal 2.5e-5
variable           L equal 20*${dx}
variable           Lx  equal ${L}
variable           Ly  equal ${L}
variable           Lz  equal ${L}

# create fluid particles
variable           sdpd_rho equal 1000
variable           sdpd_c equal 1e-1
variable           sdpd_eta equal 1e-3  # Pa.s
variable           sdpd_mu  equal ${sdpd_eta}/${sdpd_rho}
variable           sdpd_mass equal ${dx}*${dx}*${dx}*${sdpd_rho}

# smothing length
variable          h equal 3*${dx}
variable          Nfreq equal 1000


# dimenshen        dependent part
region             box block 0.0 ${Lx}  0.0 ${Ly} 0.0 ${Lz} units box
create_box         1 box
lattice            sc ${dx}
create_atoms       1 region box

group               box type 1    

mass               1 ${sdpd_mass}
set                group all meso_rho ${sdpd_rho}

variable           velx atom ${sdpd_mass}*cos(2*PI*x/${L})*sin(2*PI*y/${L})*cos(2*PI*z/${L})
variable           vely atom -${sdpd_mass}*sin(2*PI*x/${L})*cos(2*PI*y/${L})*cos(2*PI*z/${L})
variable           velz equal 0
velocity           box set v_velx v_vely 0
 
# use Tait's EOS in combination with Morris' laminar viscosity.
# We set rho_0 = 1000 kg/m^3, c = 0.1 m/s, h = 6.5e-5 m.
# The dynamic viscosity is set to 1.0e-3 Pa s, corresponding to a kinematic viscosity of 1.0e-6 m^2/s
pair_style      hybrid sph/taitwater/morris
pair_coeff         * *    sph/taitwater/morris ${sdpd_rho} ${sdpd_c} ${sdpd_eta} ${h}

compute rho_peratom all meso_rho/atom
compute e_peratom all meso_e/atom
compute ke_peratom all ke/atom
compute esph all reduce sum c_e_peratom
compute ke all ke
variable  etot equal c_ke+c_esph


# do full time integration for shear driver and fluid, but keep walls stationary
fix                integrate_fix_full all meso

# average velocity
compute vxav all reduce ave vx
variable  vx_cm atom vx-c_vxav
fix av_vx all ave/spatial 1 ${Nfreq} ${Nfreq} y center 0.01 v_vx_cm file vx.av ave running units reduced

dump               dump_id all custom 1000 dump*.dat id type x y z vx vy vz c_rho_peratom
dump_modify        dump_id first yes
dump_modify        dump_id sort id
dump_modify        dump_id pad 8
thermo_style       custom step  c_esph 
thermo_modify      norm no
thermo             1



neighbor           3.0e-6 bin
neigh_modify       delay 0 every 1

include            settimestep.lmp
timestep           ${dt}
run                400000

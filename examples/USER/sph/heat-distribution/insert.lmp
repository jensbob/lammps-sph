log                ${dname}/log.lammps
echo               both
units              si
atom_style         meso
# periodic boundaries to have a correct density on the wall
# TODO: make density fixed for the choosen particles
boundary          p p p

#variable          ndim equal 3 
dimension         ${ndim}
include           vars.lmp

# create simulation box
variable           xcenter equal 0.5*${Lx}
variable           ycenter equal 0.5*${Ly}
if ${ndim}==3 then &
"variable           zcenter equal 0.5*${Lz}" &
else &
"variable           zcenter equal 0.0" &

if ${ndim}==2 then &
"variable           pLz    equal  1.0e-3" &
"variable           nLz    equal  -1.0e-3" &
"region             box block 0.0 ${Lx}  0.0 ${Ly} ${nLz} ${pLz} units box" &
else &
"region             box block 0.0 ${Lx}  0.0 ${Ly} 0.0 ${Lz} units box"

# create box with two types of particles (water, gas)
create_box         2 box

# create gas particles
if ${ndim}==2 then &
"lattice            sq ${dx}" &
else &
"lattice            sc ${dx}"

create_atoms       ${g_type} region box

# create walls on the top and on the bottom
variable     x1  equal 3*${dx}
variable     x2  equal ${Lx}-2.5*${dx}
variable     y1 equal 3*${dx}
variable     y2  equal ${Ly}-2.5*${dx}
region	     rflow block ${x1} ${x2} ${y1} ${y2} EDGE EDGE units box

group	     flow region rflow
group	     boundary subtract all flow

compute            rho_peratom all meso_rho/atom
compute            colorgradient_peratom all meso_colorgradient/atom
compute         ie_atom all meso_e/atom
compute         ie all reduce sum c_ie_atom
variable        vie equal c_ie

# do full time integration for all particles
fix                integrate_fix_full all meso

dump               dump_id all custom ${Nfreq} ${dname}/dump*.dat id type x y z vx vy vz &
                                      c_rho_peratom c_ie_atom
dump_modify        dump_id first yes sort id pad 8


neighbor           3.0e-2 bin
neigh_modify       delay 0 every 1

communicate        single vel yes
set                group all meso_rho ${sph_rho_g}

pair_style         hybrid/overlay sph/rhosum_multiphase 1 sph/heatconduction

pair_coeff         * * sph/rhosum_multiphase   ${h}
pair_coeff         * * sph/heatconduction  ${D_heat} ${h}

dump               dump_xyz all xyz ${Nfreq} ${dname}/data.xyz
dump_modify        dump_xyz element A B

variable            time equal step*dt

timestep            1e-3

set               group boundary meso_e 2.0
set               group flow     meso_e 1.0
set               type ${d_type} mass ${sph_mass_d}
set               type ${g_type} mass ${sph_mass_g}
set               type ${d_type} meso_rho ${sph_rho_d}
set               type ${g_type} meso_rho ${sph_rho_g}


thermo_style        custom step v_time
thermo              10

run               1000



